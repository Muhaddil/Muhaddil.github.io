<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Documentación de Muhaddil" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="./styles/index3.css" />
    <link rel="stylesheet" href="./styles/docs.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <title>Documentación | Muhaddil</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>

<style>
    body {
        cursor: none !important;
    }

    a,
    i,
    button {
        cursor: none !important;
    }

    #scrollToTop {
        cursor: none !important;
    }

    @media (max-width: 768px) {
        body {
            cursor: auto;
        }

        .custom-cursor {
            display: none;
        }
    }

    .docs-warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
        padding: 12px 16px;
        border-radius: 6px;
        margin-bottom: 16px;
        font-weight: bold;
        display: block;
    }

    .lang-toggle {
        display: flex;
        gap: 5px;
        margin: 0 10px;
    }

    .lang-btn {
        background: transparent;
        border: 1px solid var(--text-color);
        color: var(--text-color);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.8rem;
        transition: all 0.3s ease;
    }

    .lang-btn:hover,
    .lang-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }
</style>

<body>
    <div class="custom-cursor"></div>
    <div class="gradient-bg"></div>
    <div class="particles" id="particles"></div>

    <nav>
        <div class="nav-container">
            <button class="mobile-menu-toggle" id="sidebar-toggle" aria-label="Menu">
                <i class="fas fa-bars"></i>
            </button>
            <a href="index.html" class="logo">Muhaddil</a>
            <div class="nav-actions">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="docs-search" placeholder="Buscar documentación..."
                        data-i18n="docs.searchPlaceholder">
                    <div class="search-results" id="search-results"></div>
                </div>
                <div class="lang-toggle">
                    <button class="lang-btn active" data-lang="es">ES</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-sun" id="theme-icon"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="docs-container">
        <aside class="docs-sidebar">
            <div class="sidebar-content" id="sidebar-content">
                <!-- Categories will be injected here -->
            </div>
        </aside>

        <main class="docs-content">
            <div id="content-area">
                <div id="docs-warning" class="docs-warning" data-i18n="docs.warning">
                    ⚠️ La documentación se está generando. Algunas secciones pueden no estar completas.
                </div>

                <div class="welcome-message">
                    <h1 data-i18n="docs.welcomeTitle">Bienvenido a la Documentación</h1>
                    <p data-i18n="docs.welcomeText">Selecciona un script del menú lateral para ver su documentación
                        detallada.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const themeIcon = document.getElementById('theme-icon');

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }

        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            const currentTheme = html.getAttribute('data-theme');

            if (currentTheme === 'dark') {
                html.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        const cursor = document.querySelector('.custom-cursor');
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });

        document.addEventListener('mousedown', () => cursor.classList.add('active'));
        document.addEventListener('mouseup', () => cursor.classList.remove('active'));

        document.addEventListener('mouseover', (e) => {
            if (e.target.closest('a') || e.target.closest('button') || e.target.closest('.sidebar-link')) {
                cursor.classList.add('active');
            }
        });

        document.addEventListener('mouseout', (e) => {
            if (e.target.closest('a') || e.target.closest('button') || e.target.closest('.sidebar-link')) {
                cursor.classList.remove('active');
            }
        });

        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 30; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.top = Math.random() * 100 + '%';
            particle.style.setProperty('--tx', (Math.random() - 0.5) * 1000 + 'px');
            particle.style.setProperty('--ty', (Math.random() - 0.5) * 1000 + 'px');
            particle.style.animationDelay = Math.random() * 20 + 's';
            particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
            particlesContainer.appendChild(particle);
        }

        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.querySelector('.docs-sidebar');

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('open');
            });
        }

        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768) {
                if (sidebar && !sidebar.contains(e.target) && sidebarToggle && !sidebarToggle.contains(e.target) && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                }
            }
        });

        let docsData = null;

        async function loadDocs() {
            try {
                const lang = localStorage.getItem('lang') || 'es';
                const response = await fetch(`data/docs-${lang}.json`);
                if (!response.ok) throw new Error('Not found');
                docsData = await response.json();
                renderSidebar();
                handleHashChange();
            } catch (error) {
                console.error('Error loading documentation:', error);
                if (localStorage.getItem('lang') !== 'es') {
                    try {
                        const response = await fetch(`data/docs-es.json`);
                        docsData = await response.json();
                        renderSidebar();
                        handleHashChange();
                        return;
                    } catch (e) { }
                }
                document.getElementById('content-area').innerHTML = '<p>Error cargando la documentación.</p>';
            }
        }

        function renderSidebar() {
            const sidebar = document.getElementById('sidebar-content');
            sidebar.innerHTML = '';

            docsData.categories.forEach(category => {
                const categoryEl = document.createElement('div');
                categoryEl.className = 'sidebar-category';

                const title = document.createElement('h3');
                title.innerHTML = `<i class="${category.icon}"></i> ${category.name}`;
                categoryEl.appendChild(title);

                const list = document.createElement('ul');
                category.scripts.forEach(script => {
                    const item = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = `#${script.id}`;
                    link.className = 'sidebar-link';
                    link.textContent = script.title;
                    link.dataset.id = script.id;
                    item.appendChild(link);
                    list.appendChild(item);
                });

                categoryEl.appendChild(list);
                sidebar.appendChild(categoryEl);
            });
        }

        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;");
        }

        function renderContent(content) {
            if (!content) return '';

            if (typeof content === 'string') {
                return `
                    <div class="code-block">
                        <pre>${content}</pre>
                    </div>
                `;
            }

            if (Array.isArray(content)) {
                return content.map(block => {
                    if (block.type === 'text') {
                        return `<p class="doc-text">${block.content}</p>`;
                    } else if (block.type === 'code') {
                        const code = Array.isArray(block.content)
                            ? block.content.join('\n')
                            : block.content;

                        const langClass = block.language ? `language-${block.language}` : '';

                        return `
                            <div class="code-block">
                                <pre><code class="${langClass}">${escapeHtml(code)}</code></pre>
                            </div>
                        `;
                    } else if (block.type === 'list') {
                        return `
                            <ul class="doc-list">
                                ${block.content.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        `;
                    }
                    return '';
                }).join('');
            }

            return '';
        }

        function renderScript(scriptId) {
            let script = null;
            for (const cat of docsData.categories) {
                script = cat.scripts.find(s => s.id === scriptId);
                if (script) break;
            }

            if (!script) return;

            const content = document.getElementById('content-area');

            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            const activeLink = document.querySelector(`.sidebar-link[data-id="${scriptId}"]`);
            if (activeLink) activeLink.classList.add('active');

            let html = `
                <div class="doc-header fade-in visible">
                    <h1>${script.title}</h1>
                    <p class="doc-description">${script.description}</p>
                    ${script.github ? `
<a href="${script.github}" target="_blank" class="button">
<i class="fab fa-github"></i> ${i18n.t('buttons.viewGithub')}
</a>` : ''}
                </div>

                <div class="doc-section fade-in visible">
                    <h2><i class="fas fa-star"></i> ${i18n.t('docs.sections.features')}</h2>
                    <ul class="features-list">
                        ${script.features.map(f => `<li>${f}</li>`).join('')}
                    </ul>
                </div>
            `;

            if (script.installation) {
                html += `
                    <div class="doc-section fade-in visible">
                        <h2 id="section-installation"><i class="fas fa-download"></i> ${i18n.t('docs.sections.installation')}</h2>
                        ${renderContent(script.installation)}
                    </div>
                `;
            }

            if (script.configuration) {
                html += `
                    <div class="doc-section fade-in visible">
                        <h2><i class="fas fa-cog"></i> ${i18n.t('docs.sections.configuration')}</h2>
                        ${renderContent(script.configuration)}
                    </div>
                `;
            }

            if (script.usage) {
                html += `
                    <div class="doc-section fade-in visible">
                        <h2><i class="fas fa-book"></i> ${i18n.t('docs.sections.usage')}</h2>
                        <p>${script.usage}</p>
                    </div>
                `;
            }

            if (script.commands && script.commands.length > 0) {
                html += `
                    <div class="doc-section fade-in visible">
                        <h2><i class="fas fa-terminal"></i> ${i18n.t('docs.sections.commands')}</h2>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>${i18n.t('docs.sections.commands.command')}</th>
                                        <th>${i18n.t('docs.sections.commands.description')}</th>
                                        <th>${i18n.t('docs.sections.commands.permission')}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${script.commands.map(cmd => `
                                        <tr id="command-${cmd.name}">
                                            <td><code>${cmd.name}</code></td>
                                            <td>${cmd.description}</td>
                                            <td><span class="badge">${cmd.permission}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            if (script.exports && script.exports.length > 0) {
                html += `
                    <div class="doc-section fade-in visible">
                        <h2><i class="fas fa-code"></i> Exports</h2>
                        ${script.exports.map(exp => `
                            <div class="export-item" id="export-${exp.name}">
                                <div class="export-header">
                                    <h3>${exp.name}</h3>
                                    ${exp.side ? `<span class="side-badge ${exp.side.toLowerCase()}">${exp.side}</span>` : ''}
                                </div>
                                <p class="export-description">${exp.description}</p>
                                
                                ${exp.usage ? `
                                    <div class="code-block">
                                        <pre>${exp.usage}</pre>
                                    </div>
                                ` : ''}

                                ${exp.params && exp.params.length > 0 ? `
                                    <div class="export-params">
                                        <h4>Parámetros</h4>
                                        <ul>
                                            ${exp.params.map(param => `
                                                <li>
                                                    <span class="param-name">${param.name}</span>
                                                    <span class="param-type">${param.type}</span>
                                                    <span class="param-desc">${param.description}</span>
                                                </li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                ` : ''}

                                ${exp.return ? `
                                    <div class="export-return">
                                        <h4>Retorna</h4>
                                        <div class="return-content">
                                            <span class="param-type">${exp.return.type}</span>
                                            <span class="param-desc">${exp.return.description}</span>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            content.innerHTML = html;
            hljs.highlightAll();
            window.scrollTo(0, 0);
        }

        function addResult(script, title, desc, anchor, type) {
            const item = document.createElement('div');
            item.className = 'search-result-item';

            item.innerHTML = `
        <div class="search-result-title">${title}</div>
        <div class="search-result-desc">
            ${type} — ${script.title}
        </div>
    `;

            item.addEventListener('click', () => {
                window.location.href = `#${script.id}?section=${anchor}`;
                searchResults.style.display = 'none';
                searchInput.value = '';
            });

            searchResults.appendChild(item);
        }

        function handleHashChange() {
            const fullHash = window.location.hash.slice(1);
            if (!fullHash) return;

            const [scriptId, query] = fullHash.split('?');
            renderScript(scriptId);

            if (query) {
                const params = new URLSearchParams(query);
                const section = params.get('section');
                if (section) {
                    scrollToSection(section);
                }
            }
        }

        function scrollToSection(sectionId) {
            setTimeout(() => {
                const el = document.getElementById(sectionId);
                if (el) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    el.style.outline = '2px solid var(--primary)';
                    el.style.borderRadius = '8px';
                    setTimeout(() => el.style.outline = '', 2000);
                }
            }, 150);
        }

        function flattenContentBlocks(blocks) {
            if (!blocks) return '';
            if (typeof blocks === 'string') return blocks;

            return blocks.map(b => {
                if (b.type === 'text') return b.content;
                if (b.type === 'list') return b.content.join(' ');
                if (b.type === 'code') {
                    return Array.isArray(b.content) ? b.content.join(' ') : b.content;
                }
                return '';
            }).join(' ');
        }

        function flattenExports(exportsArr) {
            if (!exportsArr) return '';

            return exportsArr.map(exp => [
                exp.name,
                exp.description,
                exp.usage,
                exp.side,
                exp.params?.map(p => `${p.name} ${p.type} ${p.description}`).join(' '),
                exp.return ? `${exp.return.type} ${exp.return.description}` : ''
            ].join(' ')).join(' ');
        }

        const searchResults = document.getElementById('search-results');
        const searchInput = document.getElementById('docs-search');
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            searchResults.innerHTML = '';

            if (!term) {
                searchResults.style.display = 'none';
                return;
            }

            docsData.categories.forEach(cat => {
                cat.scripts.forEach(script => {

                    if (script.title.toLowerCase().includes(term)) {
                        addResult(script, script.title, script.description, '', 'Script');
                    }

                    script.exports?.forEach(exp => {
                        const text = `${exp.name} ${exp.description} ${exp.usage}`.toLowerCase();
                        if (text.includes(term)) {
                            addResult(script, exp.name, exp.description, `export-${exp.name}`, 'Export');
                        }
                    });

                    script.commands?.forEach(cmd => {
                        const text = `${cmd.name} ${cmd.description}`.toLowerCase();
                        if (text.includes(term)) {
                            addResult(script, cmd.name, cmd.description, `command-${cmd.name}`, 'Comando');
                        }
                    });

                    if (flattenContentBlocks(script.installation).toLowerCase().includes(term)) {
                        addResult(script, 'Instalación', 'Instrucciones de instalación', 'section-installation', 'Sección');
                    }

                    if (flattenContentBlocks(script.configuration).toLowerCase().includes(term)) {
                        addResult(script, 'Configuración', 'Opciones de configuración', 'section-configuration', 'Sección');
                    }

                });
            });

            searchResults.style.display = searchResults.innerHTML ? 'block' : 'none';
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                searchResults.style.display = 'none';
            }
        });

        window.addEventListener('hashchange', handleHashChange);
        window.addEventListener('load', () => {
            initTheme();
            loadDocs();
        });
    </script>
    <script src="js/localization.js"></script>
    <script>hljs.highlightAll();</script>
</body>

</html>